<html><head><base href="/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create New Content - CryptoFans</title>
	<meta name="description" content="CryptoFans - Create and Share Content with any Token on Polygon network">
	<meta name="img" content="https://cryptofans.io/img/preview.png">
  <meta property="og:image" content="https://cryptofans.io/img/preview.png">
  <meta name="twitter:image" content="https://cryptofans.io/img/preview.png">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&amp;display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.2/web3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
  <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js"></script>
  <script src="https://exdc.cc/sdk.js" type="module"></script>
  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="stylesheet" href="/styles/add.css">
  <script src="/anim.js"></script>
</head>
<body>
  <embed type="text/html" src="/components/nav.html" class="embed-nav">

  <div class="container">
    <h1>Create New Content</h1>
    <form id="new-content-form">
      <div class="form-group">
        <label for="content-type">Content Type</label>
        <select id="content-type" name="content-type" required>
          <option value="">Select content type</option>
          <option value="article">Article</option>
          <option value="video">Video</option>
          <option value="image">Image</option>
          <option value="audio">Audio</option>
          <option value="livestream">Livestream</option>
        </select>
      </div>

      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" required>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" required></textarea>
      </div>

      <div class="form-group">
        <label for="file-upload" class="file-input-label">Upload File</label>
        <input type="file" id="file-upload" name="file-upload">
      </div>

      <div class="form-group">
        <label>Tier Selection</label>
        <div class="tier-selection" id="tier-selection">
          <!-- Tiers will be dynamically added here -->
        </div>
      </div>

      <div class="form-group">
        <label for="content-publish-date">Publish Date</label>
        <input type="datetime-local" id="content-publish-date" name="content-publish-date">
      </div>

      <div class="form-group">
        <label>Pricing</label>
        <div class="pricing-inputs">
          <div>
            <label for="price-exdc">Price (EXDC)</label>
            <input type="number" id="price-exdc" name="price-exdc" min="0" step="0.01">
          </div>
          <div>
            <label for="price-usdc">Price (USDC)</label>
            <input type="number" id="price-usdc" name="price-usdc" min="0" step="0.01">
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn">Create Content</button>
    </form>
  </div>

  <div id="animation-container"></div>

  <script>

    // Subscription tiers
    const tiers = [
      { id: 'free', name: 'Free', price: 0 },
      { id: 'bronze', name: 'Bronze', price: 10 },
      { id: 'silver', name: 'Silver', price: 25 },
      { id: 'gold', name: 'Gold', price: 50 }
    ];

    function renderTiers() {
      const container = document.getElementById('tier-selection');
      container.innerHTML = tiers.map(tier => `
        <label class="tier-option">
          <input type="checkbox" name="content-tiers" value="${tier.id}">
          ${tier.name} ($${tier.price})
        </label>
      `).join('');
    }
    renderTiers();

    animateElements();

    // Web3 integration
    window.addEventListener('load', async () => {
      if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
          await ethereum.enable();
          console.log("Web3 initialized!");
        } catch (error) {
          console.error("User denied account access");
        }
      } else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
        console.log("Web3 initialized!");
      } else {
        console.log('Non-Ethereum browser detected. Consider trying MetaMask!');
      }
    });

    // Form submission
    document.getElementById('new-content-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const contentData = Object.fromEntries(formData.entries());

      // Here you would typically send this data to your backend or smart contract
      console.log('Content data:', contentData);

      // Simulate content creation
      setTimeout(() => {
        alert('Content created successfully!');
        // Here you would typically redirect to the content management page or show a success message
      }, 1000);
    });

    // Auto-generate title and price
    document.getElementById('file-upload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        // Auto-generate title based on file name
        const title = file.name.split('.').slice(0, -1).join('.');
        document.getElementById('title').value = title;

        // Auto-generate price (this is just an example, you might want to use a more sophisticated pricing strategy)
        const sizeInMB = file.size / (1024 * 1024);
        const suggestedPrice = Math.max(1, Math.round(sizeInMB * 0.5)); // Minimum 1 EXDC, 0.5 EXDC per MB
        document.getElementById('price-exdc').value = suggestedPrice;
        document.getElementById('price-usdc').value = (suggestedPrice * 1.5).toFixed(2); // Assuming 1 EXDC = 1.5 USDC
      }
    });

    // Set default publish date to now
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    // document.getElementById('publish-date').value = now.toISOString().slice(0, 16);
  </script>
</body></html>